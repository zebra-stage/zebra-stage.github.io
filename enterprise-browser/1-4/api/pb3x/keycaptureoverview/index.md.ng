
<html>
<head>

<title>Key Capture Overview</title>

<style>
					body
					{
					font-family:verdana,arial,helvetica;
					font-size:x-small;
					margin:20;
					}
					h1
					{
					font-family:verdana,arial,helvetica;
					font-size:medium;
					font-weight:bold;
					}
					th
					{
					font-family:verdana,arial,helvetica;
					font-size:x-small;
					font-weight:bold;
					text-align:left;
					background-color:#CCCCCC;
					}
					td
					{
					font-family:verdana,arial,helvetica;
					font-size:x-small;
					text-align:left;
					}
					.clsRef
					{
					font-family:verdana,arial,helvetica;
					font-size:small;
					color:#003399;
					font-weight:bold;
					text-align:left;
					}
					.clsSyntax
					{
					font-family:courier;
					font-size:x-small;
					text-align:left;
					background-color:#ffffff;
					}
					.clsSyntaxHeadings
					{
					font-family:verdana,arial,helvetica;
					font-size:x-small;
					font-weight:bold;
					text-align:left;
					color:#000066;
					background-color:#efeff7;
					border-bottom: #c8cdde 1px solid;
					}
					.clsSyntaxCells
					{
					font-family:verdana,arial,helvetica;
					font-size:x-small;
					text-align:left;
					vertical-align:top;
					background-color:#f7f7ff;
					border-bottom: #d5d5d3 1px solid;
					}
</style>

<script type="text/javascript" language="Javascript">
					
					function ToggleSpan(SpanId, ImgID)
					{
						var path = '../Resources/'
					//Toggle the span view on or off
					var Rollup = document.all.item(SpanId);
					var RollupImg = document.all.item(ImgID);
					var ToggleExpand = path + 'ToggleExpand.gif';
					var ToggleCollapse = path + 'ToggleCollapse.gif';
					Rollup.style.display = (Rollup.style.display=='none' ? 'block' : 'none');
					RollupImg.src = (Rollup.style.display=='none' ? ToggleExpand : ToggleCollapse);
					}

					function CopyTemplate(sControl)
					{
					//Copy the template values held in the appropriate textarea to clipboard
					if (window.clipboardData)
					{
					window.clipboardData.setData("Text", document.all.item(sControl).value);
					}
					return false;
					}
					
				</script>
</head>

<body>

  <body topmargin="0" leftmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff" text="#000000">
    <table width="100%">
      <tr>
        <td valign="middle" width="95%">
          <h1>Key Handling in PocketBrowser: An Overview</h1>
        </td>
        <td width="5%"><img valign="middle" id="imgSymbolLogo" alt="Symbol Inc" src="../Resources/Logo.gif"></td>
      </tr>
    </table>
    <hr size="1">
    <p>

Using a combination of Key Capture and Accelerator Keys it is possible for the web page designer to fully customise how PocketBrowser processes keyboard button presses, this document outlines how this can be achieved.  Note the behaviour outlined here is applicable for PocketBrowser 3.0 and later, earlier versions may handle keys slightly differently.

    
<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('KeyCaptureSpan', 'imgKeyCaptureSpanToggle')"><img align="absmiddle" id="imgKeyCaptureSpanToggle" alt="Key Capture Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Key Capture</P>
<div id="KeyCaptureSpan" style="display:block">
<P>
The key capture meta tag is used to either navigate to a URL or execute a JavaScript function when the specified button is pressed.  All keys on the device can be caught using this tag except the modifier keys (coloured buttons) or scanner trigger, the latter being intercepted using the TriggerEvent which is not covered in this document.
</P><P>
The meta tag can specify whether the intercepted key is allowed to pass through (dispatch) to the web page or not, this requires a degree of thought when developing applications.  Keys caught and not dispatched will never be seen by the web page, so catching the number '1' will prevent the user from typing a '1' into any text box unless the key is also dispatched.  
</P><P>
The Key capture meta tag will only last for the lifespan of the currently loaded page but can also be cancelled in JavaScript by setting their content to the empty string, "".
</P>

<blockquote>
<pre class="clsSyntaxCells">

&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:All; KeyEvent:url('javascript:onKeys('%s')')"&gt;
&lt;SCRIPT&gt;
function unsetOnAllKeys()
{
	var Generic = new ActiveXObject("PocketBrowser.Generic");
	Generic.InvokeMETAFunction("KeyCapture" Content="KeyEvent:url('');");  
}
&lt;/SCRIPT&gt;
</pre>
</blockquote>

</div>

<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('OnKey0xnnSpan', 'imgOnKey0xnnSpanToggle')"><img align="absmiddle" id="imgOnKey0xnnSpanToggle" alt="OnKey0xnn Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Capturing a Single Key
</P>
<div id="OnKey0xnnSpan" style="display:block">
<P>
KeyCapture-KeyValue:0xnn will navigate to the URL or JavaScript function specified by the KeyEvent when the key specified in the "nn" part of the tag is pressed, where nn is a hexadecimal number.  For most keys an ASCII table can be used for mapping keys to hex numbers, if unsure first use KeyCapture-KeyValue:All and capture your desired a key with a KeyEvent:url('javascript:OnAllKeys('%s');').  The %s will be replaced with the code for your desired key in decimal, convert this to hex and you can then replace the nn above.  The key will not be passed onto the Browser.
</P><P>
Specifying the additional Parameter Dispatch:True will do exactly the same as KeyCapture-KeyValue:0xnn but will also send the key press on to the browser.
</P><P>
In the following example the browser will disallow the user from pressing left to advance to the previous character in a textbox, however the function 'keyTest' is called for both left and right keys.
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x25; KeyEvent:url('javascript:keyTest('Left');')"&gt;
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x27; Dispatch:True; KeyEvent:url('javascript:keyTest('Right');')"&gt;
</pre>
</blockquote>

<P>
KeyCapture can accept an alternative parameter to send a different key to the browser to that which was pressed, the following example will delete the previous character in a textbox when the user presses the left arrow
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x25; RemapTo:0x08"&gt; &lt;!-- Convert Left to Bksp --&gt;
</pre>
</blockquote>

<P>
This has a number of applications, for example code written for a device with a certain keyboard can be easily ported to another device  which may only have a subset of the keys present on the original device.  The key being remapped to does not have to exist as a physical key on the device.
</P>
</div>
    <p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('OnAllKeysSpan', 'imgOnAllKeysToggle')"><img align="absmiddle" id="imgOnAllKeysToggle" alt="OnAllKeys Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Capturing All Keys</P>
<div id="OnAllKeysSpan" style="display:block">
<P>
KeyCapture-KeyValue:All acts in exactly the same was as capturing a single key but will action every key pressed, similarly you can also specify Dispatch:True to ensure the pressed key still reaches the browser.
</P><P>
Capturing a single key will always take priority over capturing all keys, if both are specified on a web page developers should be aware of a potential pitfall.  Specifying KeyCapture-KeyValue:0xnn to navigate to a different page and also specifying KeyCapture-KeyValue:All to invoke a JavaScript function on the original page doesn't make logical sense as by the time KeyCapture-KeyValue:All is called the JavaScript function will be out of context.  
</P><P>
If you specify a KeyCapture to occur with Dispatch:True and an associated KeyEvent be aware that the KeyEvent will be executed before the key reaches the browser component.  If the key executes some JavaScript which steals focus (e.g. brings up an alert box) the key will be sent to whatever currently has focus.  
</P><P>
Be aware that alert boxes take a while for the browser to create and the key is sent immediately after the JavaScript begins executing, it is <i>unlikely</i> the following will bring up an alert box and then immediately clear it
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x25; RemapTo:0x0D"&gt;&lt;!--Convert Left arrow to ENTER--&gt;
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:All; Dispatch:True; KeyEvent:url('javascript:keyTest('BOX');')"&gt;
&lt;SCRIPT&gt;
function keyTest(param)
{
   alert(param);
}
&lt;/SCRIPT&gt;
</pre>
</blockquote>

<P>
Using KeyCapture-RemapTo:0xnn to remap to a different key will start the whole process over, consider the following example:
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x25; RemapTo:0x08"&gt; &lt;!--Convert Left arrow to BKSP--&gt;
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:All; Dispatch:True; KeyEvent:url('javascript:keyTest('ALL');')"&gt;
</pre>
</blockquote>

<P>
When the left arrow is pressed it is intercepted by PocketBrowser before reaching the browser component and a backspace key is sent.  The backspace is intercepted by PocketBrowser and the OnAllKeysDispatch tag will cause the keyTest() JavaScript function to be executed, the backspace is then allowed to continue to the browser to delete the previous character.  As already stated if keyTest changes the current focus (e.g. brings up an alert) the character will not be deleted.
</P><P>
Although it is theoretically possible to chain together a number of key remaps it is not recommended, e.g.
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x25; RemapTo:0x26"&gt; 
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x26; RemapTo:0x27"&gt; 
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x27; RemapTo:0x28"&gt; 
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x28; RemapTo:0x08"&gt; 
</pre>
</blockquote>

<P>
</div>
    <p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('ControlKeysSpan', 'imgControlKeysSpanToggle')"><img align="absmiddle" id="imgControlKeysSpanToggle" alt="Control Keys Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Control keys
	</P>
<div id="ControlKeysSpan" style="display:block">
<P>
Control keys are only implemented on CE devices as they are not recognised by Pocket Internet Explorer (which runs on Windows Mobile).  For example CTRL+O can be configured to bring up the Internet Explorer 'file open' dialog if desired, CTRL+P can bring up the 'file print' dialog e.t.c.  See the <a href="./ConfigurationSettings.html">Configuration Settings</a> for details of how to achieve this.
</P><P>
Take the example of the user pressing CTRL+O, this is seen by PocketBrowser as two key presses, 'CTRL' and 'O', both of which must reach the browser in order to bring up the file open dialog, e.g. specifying any of the following would cause the 'file open' dialog to not be displayed:
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x11; KeyEvent:url('javascript:keyTest('CTRL');')"&gt; 
</pre>
</blockquote>
<P>
Or
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" content="KeyValue:0x4F; KeyEvent:url('javascript:keyTest('O');')"&gt; 
</pre>
</blockquote>

<P>
If you want to perform custom actions for the 'CTRL' or 'O' keys and still allow CTRL+O you will need to use use the Dispatch:True parameter.
</P>
</div>
<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('JavaScriptOnKeyDownSpan', 'imgJavaScriptOnKeyDownSpanToggle')"><img align="absmiddle" id="imgJavaScriptOnKeyDownSpanToggle" alt="JavaScript OnKeyDown Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	JavaScript OnKeyDown Event
	</P>
<div id="JavaScriptOnKeyDownSpan" style="display:block">
<P>
The onkeydown event is used in JavaScript to capture all keys pressed on the keyboard, PocketBrowser uses its own meta tag to handle key processing and as such does not fully support the onkeydown event.  Developers are strongly encouraged to use the KeyCapture meta tag in preference to the onkeydown event as the same functionality can be achieved with fewer lines of code.  Consider the example of making the enter key function as the tab key, using onkeydown it will look like:
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" Content="AccelerateKey:All"&gt; &lt;!�For more information on this see following sections --&gt;
&lt;script type="text/javascript"&gt;
document.onkeydown=enterToTab;
function enterToTab(event) 
{
   k = window.event.keyCode;
   if(k == 13) 
   {
      if(nextControl.length != 0) 
      {
         eval('form1.' + nextControl + '.focus()');
      }
      return false;
   }
}
&lt;/script&gt;
</pre>
</blockquote>

<P>
In PocketBrowser this can be rewritten as:
</P>

<blockquote>
<pre class="clsSyntaxCells">
&lt;META HTTP-Equiv="KeyCapture" Content="AccelerateKey:All"&gt; &lt;!�For more information on this see following sections --&gt;
&lt;META HTTP-Equiv="KeyCapture" Content="KeyValue:0x0D; RemapTo:0x09"&gt;
</pre>
</blockquote>
<P>
The onkeydown JavaScript will need to execute enterToTab for each key press slowing the application whereas PocketBrowser will map each enter key press to a tab key.
</P><P>
The Accelerate ALL meta tag (explained in the next section) does offer near full support for the onkeydown event and the top code block will function on PocketBrowser, the only keys which can not be caught are 'Up arrow', 'Down arrow', 'Left arrow' and 'Right arrow'.  The NoSIP edit box will also display similar behaviour in its OnKeyDown event.  Using the KeyCapture meta tag with Dispatch:True will intercept keys before they reach the browser component and therefore captured keys will not invoke the onkeydown event.
</P>
</div>

<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('UntrappableKeysSpan', 'imgUntrappableKeysSpanToggle')"><img align="absmiddle" id="imgUntrappableKeysSpanToggle" alt="Untrappable Keys Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Untrappable Keys
	</P>
<div id="UntrappableKeysSpan" style="display:block">
<P>
Certain keys are not trappable in PocketBrowser, those which are intercepted by the keyboard driver and never passed to the application.  Examples of untrappable keys includes but is not limited to: Orange key, blue key, display backlight, Shift Key and on certain devices the calibration shortcut (blue key + backspace).
</P>

</div>
	<H3>Accelerator Keys</H3>

    <p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('OverviewSpan', 'imgOverviewSpanToggle')"><img align="absmiddle" id="imgOverviewSpanToggle" alt="Accelerator Keys Overview Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
	Overview</P>

<div id="OverviewSpan" style="display:block">
<P>
Accelerator keys are specific to Windows CE and define the behaviour of the keys which perform some special browser behaviour:
</P>
<blockquote>
<pre style="font-size:x-small;">
Key           Code    Usual Behaviour               Special behaviour in Internet Explorer

Left Arrow    0x25    Cursor left                   Scroll window left
Right Arrow   0x27    Cursor right                  Scroll window right
Up Arrow      0x26    Cursor up	                    Scroll window up
Down Arrow    0x28    Cursor down                   Scroll window down
Backspace     0x08    Delete previous character.    Navigate to previous page
Enter         0x0D    Cursor line feed              Submit form
Tab           0x09    Advance to next control       Advance to next control

               Table 1 : PocketBrowser Accelerate Keys
</pre>
</blockquote>

</P><P>
A web page written for PocketBrowser may not always wish to implement the special browser behaviour, e.g. to maintain the flow of the application the developer may not want the user pressing 'backspace' to navigate to the previous page.  The 'AccelerateKey' meta tag is used to customise which accelerator functionality is implemented and can take three values, 'none', 'norm' and 'all'.
</P><P>
In order for any accelerator key to be actioned the key must reach the browser, i.e. specifying the KeyCapture tag without the Dispatch:True parameter will disable all accelerator key behaviour regardless of the AccelerateKey tag.
</P>
</div>

</div>
<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('AccelerateNormSpan', 'imgAccelerateNormSpanSpanToggle')"><img align="absmiddle" id="imgAccelerateNormSpanSpanToggle" alt="Accelerate Norm Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
Accelerate NORM
</P>
<div id="AccelerateNormSpan" style="display:block">

<P>
The Accelerate 'norm' parameter is reserved for 'normal' PocketBrowser behaviour, that which will suit the majority of PocketBrowser applications.  This is the default behaviour.
</P><P>
The following table outlines the behaviour of PocketBrowser under Accelerate NORM, provided the keys are not swallowed by KeyCapture:
<blockquote>
<pre style="font-size:x-small;">
Key            Cursor inside text box	   Cursor outside text box

Left Arrow     Cursor left                 Scroll window left
Right Arrow    Cursor right                Scroll window right
Up Arrow       Cursor up                   Scroll window up
Down Arrow     Cursor down                 Scroll window down
Backspace      Delete previous character   No Action
Enter          No Action                   No Action
Tab            Advance to next control     Advance to next control

               Table 2 : Accelerate Keys - 'NORM'al Behaviour
</pre>
</blockquote>

</div>
<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('AccelerateOffSpan', 'imgAccelerateOffSpanToggle')"><img align="absmiddle" id="imgAccelerateOffSpanToggle" alt="Accelerate Off Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
Accelerate None
</P>
<div id="AccelerateOffSpan" style="display:block">
<P>
The Accelerate 'none' parameter will disable all Accelerator key behaviour.  Accelerator keys can still be caught using the KeyCapture meta tag but the keys themselves will have no effect on the application.
<blockquote>
<pre style="font-size:x-small;">
Key            Cursor inside text box	   Cursor outside text box
Left Arrow     No Action	               No Action
Right Arrow    No Action	               No Action
Up Arrow       No Action	               No Action
Down Arrow     No Action	               No Action
Backspace      No Action	               No Action
Enter          No Action	               No Action
Tab            No Action	               No Action

               Table 3 : Accelerate Keys � 'None' Behaviour
</pre>
</blockquote>
</div>

<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('AccelerateAllSpan', 'imgAccelerateAllSpanToggle')"><img align="absmiddle" id="imgAccelerateAllSpanToggle" alt="Accelerate All Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
Accelerate ALL
</P>
<div id="AccelerateAllSpan" style="display:block">
<P>
The Accelerate 'all' parameter indicates to PocketBrowser that the user wishes all accelerator keys to be handled as they would be in Internet Explorer.
</P><P>
The following table outlines the behaviour of PocketBrowser under Accelerate ALL, provided the keys are not swallowed by the KeyCapture tag:
<blockquote>
<pre style="font-size:x-small;">
Key            Cursor inside text box	                    Cursor outside text box
Left Arrow     Cursor left                                  Scroll window left
Right Arrow    Cursor right                                 Scroll window right
Up Arrow       Cursor up                                    Scroll window up
Down Arrow     Cursor down                                  Scroll window down
Backspace      Delete previous character                    Navigate to previous page
Enter          In multi-line text area:   Line feed         No Action
               In any other form control: Submit the form   No Action
Tab            Advance to next control                      Advance to next control

               Table 4 : Accelerate Keys � 'ALL' Behaviour
</pre>
</blockquote>
</div>

<p class="clsRef"><span class="ToggleView" onclick="ToggleSpan('WindowsMobileSpan', 'imgWindowsMobileSpanToggle')"><img align="absmiddle" id="imgWindowsMobileSpanToggle" alt="Windows Mobile Toggle" onmouseover="this.style.cursor='hand'" src="../Resources/ToggleCollapse.gif"></span>
Windows Mobile
</P>
<div id="WindowsMobileSpan" style="display:block">
<P>
As already stated Accelerator keys are only applicable to Windows CE, Windows Mobile devices will behave as follows:
<blockquote>
<pre style="font-size:x-small;">
Key            Cursor inside text box	                    Cursor outside text box

Left Arrow     Cursor left                                  Scroll window left
Right Arrow    Cursor right                                 Scroll window right
Up Arrow       Back to form control above *                 Back to form control above
Down Arrow     Advance to form control below *              Advance to form control below
Backspace      Delete previous character                    No Action
Enter          In multi-line text area:   Line feed         No Action
               In any other form control: No Action         No Action
Tab            Advance to next control                      Advance to next control

               Table 5 : Accelerate Keys under Windows Mobile
</pre>
</blockquote>
<P>
Although this behaviour can not be customised with the 'AccelerateKey' metatag the developer can still use the KeyCapture tag to intercept the keys and disable the behaviour.
* in a multi-line text area pressing up when the cursor is on the top line will go back to the previous form control however pressing down will move to the next line (if applicable).  Similarly if the cursor is in the bottom-most line of the text area pressing up will move the cursor to the previous line; pressing down will advance to the next control.
<P>
Although the AccelerateKey behaviour can not be customised with the 'AccelerateKey' metatag the developer can still use the KeyCapture tag to intercept the keys and disable the behaviour.
</P>
</div>


    <hr size="1">
    <div align="right">� 2016 Symbol Technologies, Inc. All rights reserved.</div>
</body>

</html>

