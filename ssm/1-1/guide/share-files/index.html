
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Online Documentation for Zebra Technologies developer tools and utilties, including EMDK for Android, EMDK for Xamarin, StageNow and Enterprise Browser.">
    <meta name="author" content="Zebra Technologies">
    <meta name="google-site-verification" content="i4B78BrWnNy8ShJwe5feRW3jO3HE6gfYlYqYbxfl8yY">
    <meta name="msvalidate.01" content="6B651B00161BCE79B8950AC09D5C4C75">
    <meta title="File Sharing">
    <title>File Sharing - TechDocs</title>
    <!-- core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
<!--     
    <link href="/css/font-awesome.min.css" rel="stylesheet">
 -->    
    <link href="/css/all.css" rel="stylesheet">
    <link href="/css/v4-shims.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/owl.carousel.css" rel="stylesheet">
    <link href="/css/owl.transitions.css" rel="stylesheet">
    <link href="/css/prettyPhoto.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">
    <link href="/css/bootstrap-treenav.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]--> 

    <script src="//load.sumome.com/" data-sumo-site-id="699cb66cf4dc59352efb45705526d15cbe314e1cd43f7761b94d96f3cf7338e8" async="async"></script>
    <link rel="shortcut icon" href="/favicon.ico">
<script src="/js/jquery.js"></script></head><!--/head-->


<body id="home" class="homepage" data-spy="scroll" data-offset="100" data-target="#toc">

    <header id="header">
        <nav id="main-menu" class="navbar navbar-default navbar-fixed-top" role="banner">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/"><img src="/images/logo.png" alt="logo" style="max-height:66px;float: inherit;
    padding-right: 3px;"></a> 
                    
                   
                </div>
                <div class="collapse navbar-collapse navbar-left">
                    <ul class="nav navbar-nav">
                        <li class="navbar-text pull-left"><strong>TechDocs</strong></li>
                        <p class="navbar-text">
                                            Secure Storage Manager
                                            1.1
                        </p>

                    </ul>
                </div>
                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        


                        <li>
                            <a href="/ssm/1-1/guide/about">
                                    About
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/guide/share-data">
                                    Data Sharing
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/guide/share-files">
                                    File Sharing
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/search">
                                    <i class="fa fa-search"></i>
                            </a>
                        </li>
                        
                        <!-- <li ><a href="/products">SDKs</a></li>
                        <li ><a href="/samples">Samples</a></li>
                        <li ><a href="/guides">Guides</a></li>
                        <li ><a href="/tutorials">Tutorials</a></li>
                        <li ><a href="/apis">APIs</a></li> -->
                        <!-- <li><a href="#"><input type="text" class="st-default-search-input"></a></li> -->
                    </ul>
                </div>
            </div><!--/.container-->
        </nav><!--/nav-->
    </header><!--/header-->
<div class="container-fluid">
    <section id="blog">
        <div class="">
            <section class="content-with-sidebar">
            <div class="row">
                <div class="col-sm-3 hidden-sm hidden-xs" id="sidebar">
                    
                    
                    <nav id="toc" data-toggle="toc" data-spy="affix" style="height: 75%; max-width: 225px; overflow-y: auto; ">
                        
                        <ul class="nav">
                            <li><strong>File Sharing</strong></li>
                        </ul>
                    </nav>
                    <div class="modal fade" id="modal-smartdocs" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" data-backdrop="true">
                    	<div class="modal-dialog">
                    		<div class="modal-content">
                    			<div class="modal-header">
                    				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                    			</div>
                    			<div class="modal-body">
                    				<form>
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">MX Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="4.0">4.0</option>
                    					  <option value="4.1">4.1</option>
                    					  <option value="4.2">4.2</option>
                    					  <option value="4.3">4.3</option>
                    					  <option value="5.0">5.0</option>
                    					</select>
                    				  </div>						
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">OSX Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="1.0">1.0</option>
                    					  <option value="1.2">1.2</option>
                    					  <option value="1.3.4-56">1.3.4-56</option>
                    					  <option value="3.4">3.4</option>
                    					  <option value="3.5">3.5</option>
                    					  <option value="3.6">3.6</option>
                    					  <option value="4.1">4.1</option>
                    					  <option value="4.2">4.2</option>
                    					  <option value="4.3">4.3</option>
                    					  <option value="4.4">4.4</option>
                    					</select>
                    				  </div>						
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">Android Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="23">6.0 Marshmallow</option>
                    					  <option value="22">5.1 Lollipop</option>
                    					  <option value="21">5.0 Lollipop</option>
                    					  <option value="19">4.4 Kitkat</option>
                    					  <option value="18">4.3 Jellybean</option>
                    					  <option value="17">4.2.x Jellybean</option>
                    					  <option value="16">4.1.x Jellybean</option>
                    					  <option value="15">4.0.3-4.0.4 Ice Cream Sandwich</option>
                    					  <option value="14">4.0-4.0.2 Ice Cream Sandwich</option>
                    					  <option value="10">2.3.3-2.3.4 Gingerbread</option>
                    					</select>
                    				  </div>
                    				  <div class="form-group">
                    				  	<button class="primary" id="btn_SaveSmartDocOptions">Save Changes</button><button class="primary" id="btn_ClearSmartDocOptions">Clear Changes</button>
                    				  </div>
                    				</form>
                    			</div>
                    	</div>
                      </div>
                    </div>
                    
                    <script type="text/javascript">
                        $(document).ready(function() {
                        	$( "#btn_SaveSmartDocOptions" ).click(function() {
                      			console.log('Saving Options');
                      			$("#modal-smartdocs").modal({show: false});
                    		});
                        	$( "#btn_SaveSmartDocOptions" ).click(function() {
                      			console.log('Clearing Options');
                      			$("#modal-smartdocs").modal({show: false});
                    		});
                        });
                    </script><link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.css">
                    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.js"></script>
                    <script type="text/javascript">
                        $(document).ready(function() {
                    
                        });
                    
                    
                    </script>
                </div>                
                <div class="col-sm-9 ">
                    <div class="row">
                        <div class="col-sm-12">
                            <section id="cta" class="wow fadeIn">
                                <div class="">
                                    <h1 id="file-sharing" class="anchor"><a class="heading-anchor" href="#file-sharing"><span></span></a>File Sharing</h1>
                                    <p>
                                            Secure Storage Manager
                                            1.1
                                    </p>
                                </div>
                            </section>                    
                        </div>
                    </div>
                    <div id="mainContent" class="row">
                        <div class="col-sm-12">
                            <div class="blog-post blog-large wow fadeInLeft" data-wow-duration="300ms" data-wow-delay="0ms">
                            <!-- Start of guide -->
                                <div class="service-box wow fadeInRight">
                                    <div class="">

                                        <p></p><h2 id="overview" class="anchor"><a class="heading-anchor" href="#overview"><span></span></a>Overview</h2>

<p>An application securely shares a file with other apps through <strong>Secure Storage Manager (SSM)</strong>, which safely the stores the file and allow the file to be accessible only by an intended target app. The shared file can be made persistent to remain on the device after an enterprise reset. The authenticity of the target app is verified with its package name and signature (optional). After the shared file is deployed, the target app can consume the shared file. This section discusses the procedure to share files securely through SSM.</p>

<p>In summary, the steps to share files using SSM are:</p>

<ol>
<li>(Optional) <a href="#1getappsignature">Get App Signature</a> to authenticate the target app</li>

<li><a href="#2deployfile">Deploy File</a> to the device</li>

<li><a href="#3notifytargetapp">Notify Target App</a> of the deployed file</li>

<li><a href="#4consumedeployedfile">Consume Deployed File</a> - target app can query, read, update, and delete the deployed file</li>
</ol>

<hr>

<h2 id="1getappsignatureoptional" class="anchor"><a class="heading-anchor" href="#1getappsignatureoptional"><span></span></a>1. Get App Signature (Optional)</h2>

<p>(Optional) For file security, generate the app signature for the target app to securely authenticate in SSM. After the app signature is generated, it is used for SSM to validate the target app's authenticity before any action can be performed with the deployed files.</p>

<p>To generate the app signature:</p>

<ol>
<li><p>Go to the <a href="/sigtools/">Zebra App Signature Tool</a> page.</p></li>

<li><p>Follow instructions for downloading and using the tool.</p></li>

<li><p>Use the command below (adapt as needed) to save the target app signature (as Base64 format string) in "Client.txt":</p>

<pre class="prettyprint"><code>Java -jar SigTools.jar GetCert -INFORM APK -OUTFORM BASE64 -IN [Client.apk] -OUTFILE Client.txt
</code></pre></li>
</ol>

<p><strong>NOTES:</strong></p>

<ul>
<li>[Client.apk] represents the app to retrieve the app signature.</li>

<li>If a signature must be read from a file, rename “Client.txt” to “packageName.txt” (substitute “packageName” with that of the target app) and place the file in the /assets directory on the device.</li>
</ul>

<hr>

<h2 id="2deployfile" class="anchor"><a class="heading-anchor" href="#2deployfile"><span></span></a>2. Deploy File</h2>

<p>A file is deployed using one of the following methods:</p>

<ul>
<li><strong>Stagenow or EMM -</strong> The file can be mass deployed to devices via StageNow or EMM for consumption by the target app. </li>

<li><strong>Programmatically -</strong> Store the file in SSM by using the Content Provider insert() API for programmatic file deployment.</li>
</ul>

<p>After the file is deployed to the device, SSM automatically detects the presence of the file and stores it securely. If deploying multiple files, deploy each file individually. Details on the use of each method are provided in the sections that follow.</p>

<h3 id="stagenowemm" class="anchor"><a class="heading-anchor" href="#stagenowemm"><span></span></a>StageNow/EMM</h3>

<p>Deploy a file (such as configuration file) to be accessed or consumed by target apps by using one of the following methods:</p>

<ul>
<li><strong>StageNow -</strong> This is a standard method to overcome <a href="https://developer.android.com/about/versions/11/privacy/storage">scoped storage</a> restrictions enforced in Android 11 or higher. For administrators to deploy files for use by a specific target app, use Zebra’s <a href="/stagenow">StageNow</a> tool with <a href="/stagenow/latest/csp/file/">File Manager</a> to create a staging profile, which specifies the file to be deployed, its source location and the target app. After the staging barcode is generated, the user scans the barcode using the StageNow client on the device. This downloads the file and stores it in SSM. </li>

<li><strong>Enterprise Mobility Management (EMM) -</strong> For administrators to deploy files for use by a specific target app via an EMM for large scale deployments, use StageNow and <a href="/oemconfig/latest/mc/#filemanagement">File Management (Zebra Managed Configuration)</a> from OEMConfig. Use EMM client to send Managed Configurations to OEMConfig via File Configuration, which specifies the file to be deployed, its source location and the target app. When the device receives the configurations via OEMConfig, it downloads the file and stores it in SSM.</li>
</ul>

<p><img alt="image" style="height:500px" src="ssm-deployment.jpg"></p>

<p><em>SSM File Deployment</em></p>

<p>With StageNow, administrators use <a href="/stagenow/latest/csp/file/">File Manager</a> to create a staging profile that deploys the shared file. The target application retrieves the deployed file via <a href="../api">Content Provider</a> and File Provider interfaces exposed via Secure Storage Manager (SSM). File Manager contains an option to set the deployed file to be persistent. This procedure is a prerequisite for EMM deployment.</p>

<p>When deploying a file to devices, the following information is required:</p>

<ul>
<li>Full path and package name of the target application that is accessing the deployed file</li>

<li>Signature of the target application in Base64 string format (optional, but recommended for security purposes)</li>

<li>Set whether to persist or not persist the deployed file</li>

<li>Source of the deployed file (remote server or local on the device)</li>

<li>Source path and filename or remote server URI</li>
</ul>

<p>To create a StageNow profile to deploy the file:</p>

<ol>
<li>Open <a href="/stagenow/latest/about/">StageNow</a> on a host computer.</li>

<li>In the StageNow home screen, click <strong>Create New Profile</strong> from the left menu.</li>

<li>Ensure MX version 11.3 or higher is selected at the top drop-down selector. The MX version on the device should match this or higher. See <a href="/mx/mx-version-on-device/">MX documentation</a> for instructions how to check the version. </li>

<li>Select <strong>Xpert Mode</strong> from the list and click <strong>Create.</strong>
<img alt="image" style="height:350px" src="./sn-xpert-mode.png"> </li>

<li>Enter the profile name. Click <strong>Start.</strong></li>

<li>Scroll down and click the plus (+) sign next to <strong>FileMgr.</strong> This adds FileMgr to the Config tab on the right side.
<img alt="image" style="height:350px" src="./sn-config-filemgr.png"> </li>

<li>Click <strong>Add.</strong></li>

<li>Enter or select the following for FileMgr:


<ul>
<li><strong>File Action:</strong> Deploy file for an application </li>

<li><strong>Target Application File Definition:</strong> [Enter the package name of the target app (that is accessing the deployed file) followed by <code>/</code> and the full path of the file]<br>
For example, to deploy a configuration file named "MC93SD.encrypted" located in the "config" folder and have it persist after an enterprise reset for app package “com.ztestapp.clientapplication”, enter: <code>com.ztestapp.clientapplication/config/MC93SD.encrypted</code></li>

<li><strong>Target Application Signature:</strong> [Enter the signature of the target app for security purposes. <i>This is optional, but recommended.</i>]<br> 
The signature must be in Base64 string format, which can be obtained by using <a href="/emdk-for-android/latest/samples/sigtools/">SigTools.jar</a>. If this field is empty, it introduces the risk of compromising the security of the deployed file.</li>

<li><strong>Persist The File:</strong> [Select whether or not to persist the file]</li>

<li><strong>Source Access Method:</strong> [Select whether the source file is located on a remote server or local on the device]


<ul>
<li>If <strong>File on a Remote Server</strong> is selected, enter the <strong>Source File URI</strong> (remote source path).</li>

<li>If <strong>File on the Device File System</strong> is selected, enter the <strong>Source Path and File Name.</strong></li></ul>
</li></ul>
</li>

<li>Click <strong>Complete Profiles.</strong> Profile creation is complete.</li>

<li>Select one of the following based on the deployment method:


<ul>
<li><strong>StageNow:</strong> Generate the barcode from the StageNow profile. Open StageNow client on the device and scan the barcode(s) generated.</li>

<li><strong>EMM:</strong> Export XML from the StageNow profile. Do not edit the XML file - it can cause unexpected behavior. Send the XML using <a href="/oemconfig/latest/mc/">OEMConfig File Management (Zebra Managed Configuration)</a> to be consumed by the EMM.</li></ul>
</li>
</ol>

<!-- 
#### EMM

For large scale deployments, administrators use [StageNow](#stagenow) to generate the XML (follow the StageNow procedure above). Then, send the XML using [File Management (Zebra Managed Configuration)](/oemconfig/latest/mc/) from OEMConfig for consumption by the EMM. 
-->

<h3 id="programmatically" class="anchor"><a class="heading-anchor" href="#programmatically"><span></span></a>Programmatically</h3>

<p>For programmatic file deployment, use insert() from <a href="#4consumedeployedfile">Content Provider</a> to store the file in SSM. The deployed file can then be accessed by the target app. There are 2 methods to pass the source file path of the deployed file:</p>

<ul>
<li><strong>File path -</strong> the actual file path where the deployed file is located on the device  e.g. "/sdcard/A.txt"</li>

<li><strong>URI -</strong> use FileProvider (from Content Provider) to generate the source path URI</li>
</ul>

<p><strong>To programmatically deploy the file by passing the file path:</strong></p>

<pre class="prettyprint"><code>    private final String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";
    private final String signature = "MIIC5DCCAcwCAQEwDQYJKoZIhvcNAQEFBQAwNzEWMBQGA1UEAwwNQW5kcm9pZ"; // Replace with target app signature

    public void insertFile() {

        Uri cpUriQuery = Uri.parse(AUTHORITY_FILE + context.getPackageName());

        try {

            ContentValues values = new ContentValues();

            values.put("target_app_package", String.format("{\"pkgs_sigs\": [{\"pkg\":\"%s\",\"sig\":\"%s\"}]}", context.getPackageName(), signature)); // If app signature is not used, pass in "null" for "signature" 
            values.put("data_name", “sourcePath”);  // Replace “sourcePath” with the file to deploy located on the device, e.g. "/sdcard/A.txt"
            values.put("data_value", “targetPath”); // Replace “targetPath” with the package name of the target app that is accessing the deployed file (or retrieve the app package using context.getPackageName()) followed by "/" and the full path of the file, e.g. "context.getPackageName()/A.txt"
            values.put("data_persist_required", true);

            Uri createdRow  = context.getContentResolver().insert(cpUriQuery, values);

            Log.i(TAG, "SSM Insert File: " + createdRow.toString());

        } catch(Exception e){

            Log.e(TAG, "SSM Insert File - error: " + e.getMessage() + "\n\n");
        }
    }
</code></pre>

<p><strong>To programmatically deploy the file by generating the URI:</strong></p>

<pre class="prettyprint"><code>    private final String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";
    private final String signature = "MIIC5DCCAcwCAQEwDQYJKoZIhvcNAQEFBQAwNzEWMBQGA1UEAwwNQW5kcm9pZ"; // Replace with target app signature

    public void onClickInsertFileAPI(View view) {

        // Replace “sourcePath” with the file path of the file to deploy located on the device, e.g. "/sdcard/A.txt"
        File file = new File(sourcePath);

        Uri contentUri = FileProvider.getUriForFile(context, context.getPackageName() + ".provider", file); 
        // The "file" path is passed to the FileProvier() API, which returns the source input uri to deploy the file. 
        // Example content uri returned: content://com.zebra.sampleapp.provider/enterprise/usr/A.txt
        context.getApplicationContext().grantUriPermission("com.zebra.securestoragemanager", contentUri, Intent.FLAG_GRANT_READ_URI_PERMISSION); // Needed to grant permission for SSM to read the uri
        Log.i(TAG, "File Content Uri "+  contentUri);

        Uri cpUriQuery = Uri.parse(AUTHORITY_FILE + context.getPackageName());
        Log.i(TAG, "authority  "+  cpUriQuery.toString());

        try {
            ContentValues values = new ContentValues();
            values.put("target_app_package", String.format("{\"pkgs_sigs\": [{\"pkg\":\"%s\",\"sig\":\"%s\"}]}", context.getPackageName(), signature));
            values.put("data_name", String.valueOf(contentUri)); // Passes the content uri as a input source
            values.put("data_value", targetPath); // Replace “targetPath” with the package name of the target app that is accessing the deployed file (or retrieve the app package using context.getPackageName()) followed by "/" and the full path of the file, e.g. "context.getPackageName()/A.txt"
            values.put("data_persist_required", persisFlagSpinner.getSelectedItem().toString());
            Uri createdRow  = context.getContentResolver().insert(cpUriQuery, values);
            Log.i(TAG, "SSM Insert File: " + createdRow.toString());
            Toast.makeText(context, "File insert success", Toast.LENGTH_SHORT).show();
            resultView.setText("Query Result");
        } catch(Exception e){
            Log.e(TAG, "SSM Insert File - error: " + e.getMessage() + "\n\n");
        }
        Log.i(TAG,"*********************************");
    }
</code></pre>

<hr>

<h2 id="3notifytargetapp" class="anchor"><a class="heading-anchor" href="#3notifytargetapp"><span></span></a>3. Notify Target App</h2>

<p>The target app is made aware of the deployed file depending on whether or not it is running at the time of deployment:</p>

<ul>
<li>If the <a href="#launchedbeforedeployment">target app is running</a> on the device when the file is deployed, SSM sends an intent notifying the target app of the deployed file along with the file information. </li>

<li>If the <a href="#launchedafterdeployment">target app is not running</a> on the device when the file is deployed, the target app can query SSM for the deployed file using the Content Provider APIs. </li>
</ul>

<p>The target app can then retrieve the file using File Provider and consume the file as needed. Target apps consuming the deployed file must target API Level 30 (Android 11) or above and have the appropriate access permissions in the manifest file:</p>

<ul>
<li><p>Add permissions to access the SSM Content and File Provider:</p>

<pre class="prettyprint"><code>&lt;uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.WRITE" /&gt;
&lt;uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.READ" /&gt;
</code></pre></li>

<li><p>Add the Query provider:</p>

<pre class="prettyprint"><code>&lt;queries&gt;
    &lt;provider android:authorities="com.zebra.securestoragemanager.securecontentprovider"/&gt; 
&lt;/queries&gt;
</code></pre></li>
</ul>

<p>For the target app to be made aware of the deployed file, the actions to take depends on whether or not the target app is running on the device prior to file deployment.</p>

<h3 id="applaunchedbeforedeployment" class="anchor"><a class="heading-anchor" href="#applaunchedbeforedeployment"><span></span></a>App Launched Before Deployment</h3>

<p>If the target app is already running on the device when the file is deployed, SSM broadcasts an explicit intent to notify the target app. The target app must register for the broadcast receiver to receive this intent and process the intent extras to retrieve the file information. SSM implemented a File Provider, which generates the content URIs for the file. The file URI provides access to the file and read/write permissions. The intent contains information to access the deployed file.</p>

<p>Intent extras:</p>

<table class="facelift" align="center" style="width:90%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Cursor Key</th>
    <th>Description</th>
  </tr>

  <tr>
    <td>secure_file_name</td>
    <td>Filename or relative file path<br><i>Example:</i> Config.json or /config/Config.json</td>
  </tr>

  <tr>
    <td>secure_file_uri</td>
    <td>File content URI to access the file via SSM File Provider<br><i>Example:</i> content://com.zebra.securestoragemanager/config/Config.json </td>
  </tr>

 <tr>
    <td>secure_is_dir</td>
    <td>Specifies whether the file URI points to a directory or file. If set to "true", it points to a directory.<br><i>Values:</i> true or false</td>
 </tr>

 <tr>
    <td>secure_file_crc</td>
    <td>MD5 checksum of the file. Applications can use this to determine whether or not the file has already been processed.</td>
 </tr>

 <tr>
    <td>secure_file_persist</td>
    <td>Flag to specify whether or not the file is persistent.<br><i>Values:</i> true or false</td>
 </tr>

</tbody></table>

<p><br></p>

<h4 id="implementabroadcastreceiverinthetargetapptoreceivethefiledeploymentnotification" class="anchor"><a class="heading-anchor" href="#implementabroadcastreceiverinthetargetapptoreceivethefiledeploymentnotification"><span></span></a>Implement a broadcast receiver in the target app to receive the file deployment notification:</h4>

<p>Add to the manifest file:</p>

<pre class="prettyprint"><code>&lt;receiver android:name=".FileNotificationReceiver"&gt;
    &lt;intent-filter &gt;
        &lt;action android:name="com.zebra.configFile.action.notify" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre>

<p>Implement the broadcast receiver:</p>

<pre class="prettyprint"><code>public class FileNotificationReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(final Context context, Intent intent) {

    if (intent != null &amp;&amp; intent.getAction().equals("com.zebra.configFile.action.notify")) {

        Bundle extras = intent.getExtras();

            if(extras != null &amp;&amp; !extras.isEmpty()) {
                String secure_file_uri = extras.getString("secure_file_uri");
                String secure_file_name = extras.getString("secure_file_name");
                String secure_is_dir = extras.getString("secure_is_dir");
                String secure_file_crc = extras.getString("secure_file_crc");
                String secure_file_persist = extras.getString("secure_file_persist");
            }
        }
    }
}
</code></pre>

<h3 id="applaunchedafterdeployment" class="anchor"><a class="heading-anchor" href="#applaunchedafterdeployment"><span></span></a>App Launched After Deployment</h3>

<p>If the target app is launched after the file is deployed, the target app can query the deployed file(s) through SSM via the Content Provider interface. If the target app is authenticated by SSM, all the file(s) information are returned in the Content Provider cursor. The target app can read the file(s) by using the content URIs available in the Content Provider cursor.</p>

<p>The Content Provider cursor contains the following information:</p>

<table class="facelift" align="center" style="width:90%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Cursor Key</th>
    <th>Description</th>
  </tr>

  <tr>
    <td>secure_file_name</td>
    <td>Filename or relative file path<br><i>Example:</i> Config.json or /config/Config.json</td>
  </tr>

  <tr>
    <td>secure_file_uri</td>
    <td>File content URI to access the file via SSM file provider<br><i>Example:</i> content://com.zebra.securestoragemanager/config/Config.json </td>
  </tr>

 <tr>
    <td>secure_is_dir</td>
    <td>Determines whether the file URI points to a directory or file. If false, the URI points to a file.<br><i>Values:</i> true or false</td>
 </tr>

 <tr>
    <td>secure_file_crc</td>
    <td>MD5 checksum of the file. This can be checked by an application to determine whether or not the file has been processed.</td>
 </tr>

 <tr>
    <td>secure_file_persist</td>
    <td>Flag to determine whether or not the file is persistent<br><i>Values:</i> true or false</td>
 </tr>

</tbody></table>

<p><br></p>

<p>See <a href="#queryfile">Query File</a> for information on implementation.</p>

<hr>

<h2 id="4consumedeployedfile" class="anchor"><a class="heading-anchor" href="#4consumedeployedfile"><span></span></a>4. Consume Deployed File</h2>

<p>The target app consumes the deployed file by using Content Provider APIs. If the target app is not registered to receive the intent from SSM when a file is deployed (see <a href="#targetapplaunchedbeforedeployment">Target App Launched Before Deployment</a>), the first step is to <a href="#queryfile">query</a> the file to verify it exists on the device before performing any other operation. </p>

<p>Content Provider APIs:</p>

<table class="facelift" style="width:100%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Action</th>
    <th>Method</th>
  </tr>

  <tr>
       <td>Add new data<br>See <a href="https://developer.android.com/reference/android/content/ContentProvider#insert(android.net.Uri,%20android.content.ContentValues)">Android reference</a></td>
    <td>Uri <b>insert</b> (Uri uri, ContentValues values)</td>
  </tr>

  <tr>
       <td>Modify/Update existing data<br>See <a href="https://developer.android.com/reference/android/content/ContentProvider#update(android.net.Uri,%20android.content.ContentValues,%20java.lang.String,%20java.lang.String[])">Android reference</a></td>
    <td>int <b>update</b> (Uri uri, ContentValues values, String selection, String[] selectionArgs)</td>
  </tr>

  <tr>
       <td>Return data based on selection criteria <br>See <a href="https://developer.android.com/reference/android/content/ContentProvider#query(android.net.Uri,%20java.lang.String[],%20java.lang.String,%20java.lang.String[],%20java.lang.String)">Android reference</a></td>
    <td>Cursor <b>query</b> (Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</td>
  </tr>

  <tr>
       <td>Delete data <br>See <a href="https://developer.android.com/reference/android/content/ContentProvider#delete(android.net.Uri,%20android.os.Bundle)">Android reference</a></td>
    <td>int <b>delete</b> (Uri uri, String selection, String[] selectionArgs)</td>
  </tr>

</tbody></table>

<p><br>
Content Provider parameters:</p>

<table class="facelift" align="center" style="width:100%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Key</th>
    <th>Value</th>
    <th>Mandatory/Optional</th>
  </tr>

  <tr>
    <td><b>target_app_package</b></td>
    <td>The package name and signature of the target app are stored in a json array. The signature must be provided in Base64 format. To generate the app signature, See <a href="#getappsignatureoptional">Get the app signature</a>.</td>
    <td>Mandatory</td>
  </tr>

  <tr>
    <td><b>data_name</b></td>
    <td>The source path and file name located on the device, e.g. "/sdcard/A.txt"</td>
    <td>Mandatory</td>
  </tr>

   <tr>
    <td><b>data_value</b></td>
    <td>The package name of the target app accessing the deployed file followed by "/" and the full path of the file, e.g. "context.getPackageName()/A.txt"</td>
    <td>Mandatory</td>
  </tr>

  <tr>
    <td><b>data_persist_required</b></td>
    <td>Sets file persistence: true or false.<br>If set to true, the file persists after enterprise reset</td>
    <td>Mandatory</td>
  </tr>

</tbody></table>

<h3 id="queryfile" class="anchor"><a class="heading-anchor" href="#queryfile"><span></span></a>Query File</h3>

<p>To query the file, the authority URI and target app package name (includes the file path and persistent flag) must be defined. When the query is made to SSM for the deployed files, all the files deployed for the target application are retuned in the Content Provider cursor. Preliminary steps are required before performing the query:</p>

<ul>
<li><p>Allow authority for the target app:</p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/file/*"
Uri cpUriQuery = Uri.parse(AUTHORITY_FILE);
</code></pre></li>

<li><p>Choose <em>one</em> of the following:</p>

<ul>
<li><p><strong>For the target app to query all deployed files and folders</strong> from SSM, add a variable that contains the key and value for the target app package and file persistence status: </p>

<pre class="prettyprint"><code>String selection = "target_app_package" + " = '" + context.getPackageName() + "'" + " AND " + "data_persist_required" + " = '" + true + "'";
</code></pre></li>

<li><p><strong>For the target app to query a specific deployed file or folder</strong> from SSM, add a variable that contains the key and value for the target app package with the deployed file/folder and data persistence status: </p>

<pre class="prettyprint"><code>String selection = "target_path" + " = '" + context.getPackageName()+"/folder/" + "'" + " AND " + "data_persist_required" + " = '" + true + "'";
</code></pre></li></ul>

<p>where "folder" represents the folder or file path. Example of resulting <code>target_path</code> values: "com.company.targetapp/Folder1/Folder2" or "com.company.targetapp/Folder1/Folder2/Config.txt".</p></li>
</ul>

<p>Sample code to query all deployed files and folders:</p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/file/*";

public void queryFile() {

    Uri cpUriQuery = Uri.parse(AUTHORITY_FILE);
    String selection = "target_app_package" + " = '" + context.getPackageName() + "'" + " AND " + "data_persist_required" + " = '" + true + "'";

    Cursor cursor = null;
    try {
        cursor = context.getContentResolver().query(cpUriQuery, null, selection, null, null);

    } catch (Exception e) {
        Log.e(TAG, "Error: "+ e.getMessage());
    }

    try {
        if(cursor !=null &amp;&amp; cursor.moveToFirst()){

            StringBuilder strBuild = new StringBuilder();
            String uriString = null;
            while (!cursor.isAfterLast()) {

                uriString = cursor.getString (cursor.getColumnIndex("secure_file_uri"));
                String fileName = cursor.getString(cursor.getColumnIndex("secure_file_name"));
                String isDir = cursor.getString(cursor.getColumnIndex("secure_is_dir"));
                String crc = cursor.getString(cursor.getColumnIndex("secure_file_crc"));

                strBuild.append("fileURI - "+uriString).append("\n").
                    append("fileName - "+ fileName).append("\n").
                    append("isDirectory - "+ isDir).append("\n").
                    append("CRC - "+ crc);

                cursor.moveToNext();
            }
        }
    } catch (Exception e) {
        Log.e(TAG, "Query data error: " + e.getMessage());
    } finally {
        if(cursor != null){
            cursor.close();
        }
    }
}
</code></pre>

<p>The resulting cursor from the file query provides the file URI and <code>secure_is_dir</code> to determine if the URI corresponds to a folder or file. If <code>secure_is_dir</code> returns false, that means the URI points to a file that can be read. For security, the target app is granted read permission to the deployed file by SSM based on signature authentication.</p>

<h3 id="readfile" class="anchor"><a class="heading-anchor" href="#readfile"><span></span></a>Read File</h3>

<p>Before reading a file, perform a <a href="#queryfile">file query</a> to retrieve the file URI. To read file content from the file URI, use Android ContentResolver object.</p>

<p>Sample code to read file content from the file URI:</p>

<pre class="prettyprint"><code>private readFile(Context context, String fileUri) throws IOException {
    InputStream inputStream = context.getContentResolver().openInputStream(Uri.parse(fileUri));
    InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
    BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
    StringBuilder strBuilder = new StringBuilder();
    String line;
    while(null != (line = bufferedReader.readLine())) {
        strBuilder.append(line);
    }
    // Perform any action with the file content
}
</code></pre>

<h3 id="updatefile" class="anchor"><a class="heading-anchor" href="#updatefile"><span></span></a>Update File</h3>

<p>To update a deployed file, overwrite the existing deployed file with an updated file. This is done by replacing the source path with the file path of the updated file located on the device. Preliminary step required before updating a deployed file:</p>

<ul>
<li><p>Allow authority for the target app: </p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";
Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE + context.getPackagename());
</code></pre></li>
</ul>

<p>Sample code to update the deployed file:</p>

<pre class="prettyprint"><code>    private final String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";
    private final String signature = "MIIC5DCCAcwCAQEwDQYJKoZIhvcNAQEFBQAwNzEWMBQGA1UEAwwNQW5kcm9pZ"; // Replace with target app signature

    private void updateFile() {
        Uri cpUriQuery = Uri.parse(AUTHORITY_FILE +context.getPackageName());

        try {
            ContentValues values = new ContentValues();
            values.put("target_app_package", String.format("{\"pkgs_sigs\": [{\"pkg\":\"%s\",\"sig\":\"%s\"}]}", context.getPackageName(), signature)); // If app signature is not used, pass in "null" for "signature" 
            values.put("data_name", "sourcePath");   // Replace “sourcePath” with the updated file located on the device, e.g. "/sdcard/A.txt"
            values.put("data_value", "targetPath");  // Replace “targetPath” with the package name of the target app that is updating the deployed file (or get the app package name using context.getPackageName()) followed by "/" and the full path of the existing deployed file, e.g. "context.getPackageName()/A.txt"
            values.put("data_persist_required", true);
            int rowNumbers = getContentResolver().update(cpUriQuery, values, null , null);
            Log.d(TAG, "Files updated: " + rowNumbers);
        } catch(Exception e){
            Log.d(TAG, "SSM Update File - Error: " + e.getMessage());
        }
    }
</code></pre>

<h3 id="deletefile" class="anchor"><a class="heading-anchor" href="#deletefile"><span></span></a>Delete File</h3>

<p>Deployed files can be deleted when the file is no longer required. Preliminary steps are required before deleting a deployed file:</p>

<ul>
<li><p>Allow authority for the target app: </p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";
Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE + context.getPackagename());
</code></pre></li>

<li><p>Add a variable that contains the key and value for the target app package and file persistence status: </p>

<pre class="prettyprint"><code>String selection = "target_app_package" + " = '" + context.getPackageName() + "'" + " AND " + "data_persist_required" + " = '" + true + "'";
</code></pre></li>
</ul>

<p>Sample code to delete all the deployed files present in SSM for the target application:</p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";

private void deleteFile() {
    Uri cpUriQuery = Uri.parse(AUTHORITY_FILE + context.getPackageName());

    try {
        String selection = "target_app_package" + " = '" + context.getPackageName() + "'" + " AND " + "data_persist_required" + " = '" + true + "'";
        int deleteStatus = getContentResolver().delete(cpUriQuery, selection, null);
        Log.d(TAG, "File deleted, status = " + deleteStatus);   // 0 means success
    } catch(Exception e){
        Log.d(TAG, "Delete file - error: " + e.getMessage());
    }
}
</code></pre>

<hr>

<h2 id="sampleapp" class="anchor"><a class="heading-anchor" href="#sampleapp"><span></span></a>Sample App</h2>

<p>See <a href="../samples/share-files/">File Sharing</a> sample app.</p>

<hr>

<h2 id="seealso" class="anchor"><a class="heading-anchor" href="#seealso"><span></span></a>See Also</h2>

<ul>
<li><a href="../about/">About SSM</a></li>

<li><a href="../share-data">Data Sharing</a></li>
</ul><p></p>
                                        


                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div><!--/.col-sm-6-->
            </div>
            </section>
        </div>
    </section>    

<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" data-backdrop="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
					</div>
					<div class="modal-body">
						<div id="modalImg">
						
						</div>
					</div>
			</div>
		  </div>
		</div> </div>
         <footer id="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-10">
                        ZEBRA and the stylized Zebra head are trademarks of Zebra Technologies Corp., registered in many jurisdictions worldwide. All other trademarks are the property of their respective owners. ©2022 Zebra Technologies Corp. and/or its affiliates.<br> <a href="https://www.zebra.com/us/en/about-zebra/company-information/legal.html">Legal</a> | <a href="https://www.zebra.com/us/en/about-zebra/company-information/compliance/information-privacy/terms-of-use.html">Terms of Use</a> | <a href="https://www.zebra.com/us/en/about-zebra/company-information/legal/privacy-statement.html">Privacy Policy</a> 
                    </div>
                     <!--
                     <div class="col-sm-2">
                        <ul class="social-icons">
                            <li><a href="http://www.facebook.com/pages/Zebra-Technologies/107703715989073"><i class="fa fa-facebook"></i></a></li>
                            <li><a href="https://twitter.com/ZebraDevs"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="http://www.youtube.com/zebratechnologies/"><i class="fa fa-youtube"></i></a></li>
                            <li><a href="https://www.linkedin.com/groups?home=&gid=3220074&trk=anet_ug_hm&goback=%2Egmr_3220074"><i class="fa fa-linkedin"></i></a></li>
                            <li><a href="https://github.com/developer-zebra"><i class="fa fa-github"></i></a></li>
                        </ul>
                    </div> -->
                 </div>
            </div>
        </footer>
    
    <!--/#footer 
        10/25/18 removed <footer id="footer" class="navbar-fixed-bottom">
    -->
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/mousescroll.js"></script>
    <script src="/js/smoothscroll.js"></script>
    <script src="/js/jquery.prettyPhoto.js"></script>
    <script src="/js/jquery.isotope.min.js"></script>
    <script src="/js/jquery.inview.min.js"></script>
    <script src="/js/wow.min.js"></script>
    <script src="/js/bootstrap-treenav.min.js"></script>
    <script src="/js/prettify.js"></script>
    <script src="/js/zepto.js"></script>
    <script src="/js/jquery.waterfall.js"></script>   
    <script src="/js/main.js"></script>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','zRzEsAUhWTTkrdEN2YfA','2.0.0');
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72584442-1', 'auto');
  ga('send', 'pageview');

</script> 

<script>
    ChatraID = 'QDvZ76min4DhLW5vJ';
    (function(d, w, c) {
        var n = d.getElementsByTagName('script')[0],
            s = d.createElement('script');
        w[c] = w[c] || function() {
            (w[c].q = w[c].q || []).push(arguments);
        };
        s.async = true;
        s.src = (d.location.protocol === 'https:' ? 'https:': 'http:')
            + '//call.chatra.io/chatra.js';
        n.parentNode.insertBefore(s, n);
    })(document, window, 'Chatra');
</script>         


</body></html>